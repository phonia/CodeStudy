@model JXCProject.Services.DTOs.EmployeeDTO

@{
    ViewBag.Title = "员工管理";
}

<script type="text/javascript">

    $(function () {
        $('#departmentTree').combotree({
            url: '@Url.Action("CreateDepartmentTree","Department")',
            lines:true
        });

        $('#btnSearch').click(function () {
            $('#grid').datagrid({
                title: '员工信息',
                width: 1000,
                url: '@Url.Action("GetPageData")',
                collapsible: true,
                pagination: true,
                queryParams: {
                    departmentId: $('#departmentTree').combotree('getValue'),
                    employeeName: $('#searchName').val()
                },
                columns: [[
            { field: 'ck', checkbox: true },
            { field: 'ID', title: 'ID', hidden: true },
            { field: 'Name', width: 100, title: '姓名', sortable: true },
            { field: 'Gender', width: 50, title: '性别', sortable: true },
            { field: 'Birthday', width: 100, title: '出生日期', sortable: true },
            { field: 'Degree', width: 100, title: '学历', sortable: true },
            { field: 'EmployeDate', width: 100, title: '入职时间', sortable: true },
            { field: 'Adress', width: 250, title: '地址', sortable: true },
            { field: 'Remarks', width: 200, title: '备注', sortable: true }
            ]],
                toolbar: [
            { id: 'btnRemove', text: '删除员工', iconCls: 'icon-remove', handler: function () {
                deleteEmployee();
            }
            },
            { id: 'btnEdit', text: '修改员工', iconCls: 'icon-edit', handler: function () {
                showEditDialog();
            }
            }
            ]
            })
        })
    });

    function showAddDialog() {
        $('<div class="tabletd"/>').dialog({
            id:'AddDialog',
            height: 400,
            width: 550,
            modal: true,
            cache: false,
            title: '新增员工',
            href: '/Employee/AddEmployee',
            iconCls: 'icon-add',
            buttons: [{
                id:'btnAdd',
                text: '提交',
                iconCls: 'icon-ok',
                handler: function () {
                    addEmployee();
                }
            }, {
                text: '关闭',
                iconCls: 'icon-cancel',
                handler: function () {
                    $(this).closest(".window-body").dialog("destroy"); 
                }
            }],
            onClose: function () {
                $(this).dialog('destroy');
            }
        });
    }

    function showEditDialog() {
        var row = $('#grid').datagrid('getSelected');
        if (row) {
            $('<div class="tabletd"/>').dialog({
                id: 'editDialog',
                height: 400,
                width: 550,
                modal: true,
                cache: false,
                title: '修改员工',
                href: '/Employee/ModifyEmployee',
                iconCls: 'icon-edit',
                buttons: [{
                    id: 'btnEdit',
                    text: '提交',
                    iconCls: 'icon-ok',
                    handler: function () {
                        editEmployee();
                    }
                }, {
                    text: '关闭',
                    iconCls: 'icon-cancel',
                    handler: function () {
                        $(this).closest(".window-body").dialog("destroy");
                    }
                }],
                onClose: function () {
                    $(this).dialog('destroy');
                }
            });
        }
        else {
            $.messager.alert('消息', '请选择要编辑的行!', 'warning');
        }
    }

    function deleteEmployee() {
        common.deleteData('grid', '/Employee/RemoveEmployee');
    }

    function onSuccess(){
        $.messager.alert("消息", "操作成功!");
    }
    
</script>

<table width="100%">
    <tr><td colspan="4" align="center" style="font-size:large;">员工管理</td></tr>
    <tr><td colspan="4" align="right"><a href="#" class="easyui-linkbutton" onclick="showAddDialog();">新增员工</a></td></tr>
    <tr>
        <td>部门名称:</td><td><input id="departmentTree" value="--请选择--"  style="width:160px;" /></td>
        <td>员工名称:</td><td>@Html.TextBox("searchName")</td>
    </tr>
    <tr><td colspan="4" align="center"><a href="#" id="btnSearch" class="easyui-linkbutton" iconCls="icon-search">查询</a></td></tr>
    <tr><td colspan="4" ><table id="grid"></table></td></tr>
</table>

